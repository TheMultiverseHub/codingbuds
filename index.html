<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mobile Optimized Code Editor</title>

  <!-- Meta for mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/theme/material-darker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/show-hint.min.css">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Fira Code', monospace;
      background: #1e1e1e;
    }

    .container {
      display: flex;
      height: 100%;
      width: 100%;
    }

    .editor-pane {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #1e1e1e;
    }

    .editor-toolbar {
      padding: 10px;
      background: #111;
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      gap: 10px;
    }

    .editor-toolbar button {
      background: #272727;
      border: none;
      color: white;
      padding: 12px 18px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .editor-toolbar button:hover {
      background: #404040;
    }

    .editor-area {
      flex: 1;
      overflow: hidden;
    }

    .preview-pane {
      flex: 1;
      border-left: 2px solid #333;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }

    /* Resizer */
    .resizer {
      width: 5px;
      cursor: ew-resize;
      background: #333;
    }

    /* Mobile Styles */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .resizer {
        display: none;
      }
      .editor-pane, .preview-pane {
        flex: none;
        height: 50%;
        width: 100%;
      }
      .editor-toolbar button {
        font-size: 18px;
        padding: 14px 20px;
      }
      .CodeMirror {
        font-size: 16px;
      }
    }
  </style>
</head>

<body>

<div class="container">
  <div class="editor-pane">
    <div class="editor-toolbar">
      <button onclick="downloadHTML()">Download</button>
      <button onclick="loadTemplate('starter')">Starter</button>
      <button onclick="loadTemplate('portfolio')">Portfolio</button>
      <button onclick="loadTemplate('blog')">Blog</button>
      <button onclick="loadTemplate('landing')">Landing Page</button>
      <button onclick="loadTemplate('grid')">Grid Layout</button>
      <button onclick="loadTemplate('contact')">Contact Form</button>
      <button onclick="loadTemplate('error404')">404 Page</button>
      <button onclick="clearEditor()">Clear</button>
    </div>
    <div class="editor-area">
      <textarea id="code"></textarea>
    </div>
  </div>

  <div class="resizer" id="dragbar"></div>

  <div class="preview-pane">
    <iframe id="preview"></iframe>
  </div>
</div>

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/css-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/javascript-hint.min.js"></script>

<script>
  // Initialize CodeMirror with dynamic mode switching
  const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
    mode: 'text/html',
    theme: 'material-darker',
    lineNumbers: true,
    lineWrapping: true,
    tabSize: 2,
    autofocus: true,
    viewportMargin: Infinity,
    extraKeys: {
      "Ctrl-Space": "autocomplete", // Auto-complete on Ctrl + Space
      "Ctrl-Alt-H": () => toggleMode('html'),
      "Ctrl-Alt-C": () => toggleMode('css'),
      "Ctrl-Alt-J": () => toggleMode('javascript')
    }
  });

  let currentMode = 'html';

  // Function to toggle mode between HTML, CSS, and JS
  function toggleMode(mode) {
    if (currentMode === mode) return;
    currentMode = mode;
    if (mode === 'html') {
      editor.setOption('mode', 'text/html');
    } else if (mode === 'css') {
      editor.setOption('mode', 'text/css');
    } else if (mode === 'javascript') {
      editor.setOption('mode', 'text/javascript');
    }
    editor.focus();
  }

  // Update live preview
  function updatePreview() {
    const code = editor.getValue();
    document.getElementById('preview').srcdoc = code;
    localStorage.setItem('mobileOptimizedCode', code);
  }

  editor.on('change', updatePreview);

  // Load from storage
  window.addEventListener('load', () => {
    const saved = localStorage.getItem('mobileOptimizedCode');
    if (saved) {
      editor.setValue(saved);
      updatePreview();
    }
  });

  // Clear editor
  function clearEditor() {
    editor.setValue('');
    localStorage.removeItem('mobileOptimizedCode');
    updatePreview();
  }

  // Download code
  function downloadHTML() {
    const blob = new Blob([editor.getValue()], { type: "text/html" });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "index.html";
    a.click();
  }

  // Templates
  const templates = {
    starter: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Starter</title>
  <style>
    body { font-family: Arial; background: #fafafa; text-align: center; padding: 40px; }
  </style>
</head>
<body>
  <h1>Hello World!</h1>
  <script>
    console.log('Starter Loaded');
  <\/script>
</body>
</html>`,
    portfolio: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portfolio</title>
  <style>
    body { margin: 0; font-family: Poppins, sans-serif; background: #222; color: #eee; }
    header, footer { background: #333; padding: 20px; text-align: center; }
  </style>
</head>
<body>
  <header>
    <h1>My Portfolio</h1>
  </header>
  <main style="padding: 20px;">
    <h2>About Me</h2>
    <p>This is my portfolio website!</p>
  </main>
  <footer>
    <p>© 2025 Me</p>
  </footer>
  <script>
    console.log('Portfolio Loaded');
  <\/script>
</body>
</html>`,
    blog: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Blog</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
    header { background-color: #333; color: white; text-align: center; padding: 20px; }
    footer { background-color: #333; color: white; text-align: center; padding: 10px; position: fixed; bottom: 0; width: 100%; }
    .post { padding: 20px; border-bottom: 1px solid #ddd; background-color: white; margin: 20px; }
  </style>
</head>
<body>
  <header><h1>My Blog</h1></header>
  <main>
    <div class="post">
      <h2>Post Title</h2>
      <p>This is an example of a blog post.</p>
    </div>
    <div class="post">
      <h2>Another Post</h2>
      <p>This is another example of a blog post.</p>
    </div>
  </main>
  <footer>© 2025 My Blog</footer>
</body>
</html>`,
    landing: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Landing Page</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
    .hero { text-align: center; padding: 100px 0; background-color: #333; color: white; }
    .cta { background-color: #e60000; padding: 20px; color: white; font-size: 24px; }
  </style>
</head>
<body>
  <div class="hero">
    <h1>Welcome to Our Product!</h1>
    <p>Discover amazing features with us!</p>
  </div>
  <div class="cta">
    <p>Call to Action</p>
  </div>
</body>
</html>`,
    grid: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grid Layout</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f4f4; }
    .container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 20px; }
    .item { background-color: #ddd; padding: 20px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <div class="item">Item 1</div>
    <div class="item">Item 2</div>
    <div class="item">Item 3</div>
    <div class="item">Item 4</div>
    <div class="item">Item 5</div>
    <div class="item">Item 6</div>
  </div>
</body>
</html>`,
    contact: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contact Form</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; padding: 0; }
    .form-container { max-width: 500px; margin: 50px auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; }
    button { width: 100%; padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Contact Us</h2>
    <form>
      <input type="text" id="name" placeholder="Your Name" required>
      <input type="email" id="email" placeholder="Your Email" required>
      <textarea id="message" rows="4" placeholder="Your Message" required></textarea>
      <button type="submit">Send Message</button>
    </form>
  </div>
</body>
</html>`,
    error404: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>404 - Not Found</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; text-align: center; }
    .error-container { padding: 100px 20px; }
    h1 { font-size: 100px; color: #ff0000; }
    p { font-size: 24px; color: #333; }
    a { color: #0066cc; text-decoration: none; }
  </style>
</head>
<body>
  <div class="error-container">
    <h1>404</h1>
    <p>Sorry, the page you're looking for cannot be found.</p>
    <p><a href="/">Go Back to Home</a></p>
  </div>
</body>
</html>`
  };

  // Function to load template into the editor
  function loadTemplate(template) {
    if (templates[template]) {
      editor.setValue(templates[template]);
      updatePreview();
    }
  }

  // CodeMirror Resizer (for mobile responsiveness)
  const dragbar = document.getElementById('dragbar');
  const editorPane = document.querySelector('.editor-pane');
  const previewPane = document.querySelector('.preview-pane');
  let isDragging = false;

  dragbar.addEventListener('mousedown', (e) => {
    isDragging = true;
    const startX = e.clientX;
    const startWidth = editorPane.offsetWidth;

    function onMouseMove(e) {
      if (isDragging) {
        const newWidth = startWidth + (e.clientX - startX);
        editorPane.style.width = `${newWidth}px`;
        previewPane.style.width = `${window.innerWidth - newWidth - dragbar.offsetWidth}px`;
      }
    }

    function onMouseUp() {
      isDragging = false;
      window.removeEventListener('mousemove', onMouseMove);
      window.removeEventListener('mouseup', onMouseUp);
    }

    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('mouseup', onMouseUp);
  });
</script>

</body>
</html>